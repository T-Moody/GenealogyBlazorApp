@page "/admin/home"
@rendermode InteractiveAuto

@using GenealogyBlazorApp.Shared.DTOs
@inject HttpClient Http

<h1>Home Page Content</h1>

<p>Edit the content for the home page below. Click on a section to edit it.</p>

@if (homeContent == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="home-editor">
        <div class="editable-section" @onclick='() => EditSection("SiteTitle")'>
            <label>Site Title</label>
            @if (editingSection == "SiteTitle")
            {
                <input @bind="homeContent.SiteTitle" />
            }
            else
            {
                <p>@homeContent.SiteTitle</p>
            }
        </div>

        <div class="editable-section" @onclick='() => EditSection("Tagline")'>
            <label>Tagline</label>
            @if (editingSection == "Tagline")
            {
                <input @bind="homeContent.Tagline" />
            }
            else
            {
                <p>@homeContent.Tagline</p>
            }
        </div>

        <div class="editable-section" @onclick='() => EditSection("AboutContent")'>
            <label>About Content</label>
            @if (editingSection == "AboutContent")
            {
                <textarea @bind="homeContent.AboutContent"></textarea>
            }
            else
            {
                <p>@homeContent.AboutContent</p>
            }
        </div>

        <button @onclick="SaveChanges">Publish Changes</button>
    </div>
}

@code {
    private HomeContentDto? homeContent;
    private string? editingSection;

    protected override async Task OnInitializedAsync()
    {
        homeContent = await Http.GetFromJsonAsync<HomeContentDto>("/api/admin/home-content");
    }

    private void EditSection(string sectionName)
    {
        editingSection = sectionName;
    }

    private async Task SaveChanges()
    {
        if (homeContent != null)
        {
            await Http.PutAsJsonAsync("/api/admin/home-content", homeContent);
            editingSection = null;
        }
    }
}
